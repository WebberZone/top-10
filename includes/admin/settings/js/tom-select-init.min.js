!function(t){"use strict";function e(t){if(!t||"object"!=typeof t)return null;const e=t.id||t.value||"",n=t.name||t.text||e;return e||n?{value:String(e),text:String(n)}:null}function n(n){(n&&"function"==typeof n.querySelectorAll?n:document).querySelectorAll(".ts_autocomplete").forEach(function(n){if(n.tomselect)return;const o=n.getAttribute("data-wp-prefix")||"WZ",r=window[`${o}TomSelectSettings`]||window.WZTomSelectSettings||window.freemkitTomSelectSettings||{};if(!r||"object"!=typeof r)return;const a=n.getAttribute("data-wp-action")||r.action,i=n.getAttribute("data-wp-nonce")||r.nonce,u=n.getAttribute("data-wp-endpoint")||r.endpoint,c=r.strings||{},l=function(t,n){if(!t||!n)return[];const o=t[n];return Array.isArray(o)?o.map(e).filter(Boolean):[]}(r,u),s=n.value.split(",").map(t=>t.trim()).filter(Boolean),d=function(t){const e="string"==typeof t?t:"";return"category"===e||"post_tag"===e||e.includes("tax")}(u);if(d&&s.length>0){const t=s.map(t=>{const e=t.match(/^(.*)\s+\(.*:\d+\)$/);return{value:t,text:e?e[1]:t}}),e=[...l];t.forEach(t=>{e.some(e=>e.value===t.value)||e.push(t)}),l.length=0,l.push(...e)}!d&&s.length>0&&s.forEach(t=>{l.some(e=>e.value===t)||l.push({value:t,text:t})});let p={};const f=n.getAttribute("data-ts-config");if(f)try{p=JSON.parse(f)}catch(t){console.error("Error parsing custom config:",f,t)}const m={...{plugins:["dropdown_input","clear_button","remove_button"],valueField:"value",labelField:"text",searchField:["text","value"],options:l,items:s,persist:!0,createOnBlur:!1,create:!1,render:{no_results:(t,e)=>`<div class="no-results">${(c.no_results||'No results for "%s"').replace("%s",e(t.input))}</div>`,option:(t,e)=>d||t.text===t.value?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`,item:(t,e)=>d||t.text===t.value?`<div>${e(t.value)}</div>`:`<div>${e(t.text)} (${e(t.value)})</div>`},load:function(n,o){n.length?t.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:a,nonce:i,q:n,endpoint:u},error:function(){o()},success:function(t){t.success&&t.data&&Array.isArray(t.data.items)?o(t.data.items.map(e).filter(Boolean)):t.success&&Array.isArray(t.data)?o(t.data.map(e).filter(Boolean)):o()}}):o()}},...p};try{new TomSelect(n,m)}catch(t){console.error("Tom Select initialization error:",t)}})}window.WZInitTomSelect=n,document.addEventListener("wz:repeater-item-added",function(t){n((t&&t.detail?t.detail:{}).container||document)}),t(document).ready(function(){n(document)})}(jQuery);